<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css">
  <script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
  <script src="https://cdn.polyfill.io/v1/polyfill.min.js"></script>

  <style>
    body {
      height: 100%;
      width: 100%;
      position: absolute;
      margin: 0;
    }
    #map {
      width: 100%;
      height: 100%;
    }
  </style>
</head>
<body>
  <div id="map"></div>
  <script src="analyst.js"></script>
  <script>
    var Analyst = window.Analyst
    var analyst = new Analyst(window.L, {
      apiUrl: '',
      tileUrl: '',
      destinationPointsetId: '',
      graphId: ''
    })

    var startLoc = [42.35, -71.1]

    var map = L.map('map').setView(startLoc, 11)

    // add an OpenStreetMap tile layer
    L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(map)

    var first = true
    var marker = L
      .marker(startLoc, {
        draggable: true
      })
      .addTo(map)
      .on('dragend', function (e) {
        var ll = marker.getLatLng()
        analyst
          .singlePointRequest({
            fromLat: ll.lat,
            fromLon: ll.lng,
            toLat: ll.lat,
            toLon: ll.lng
          })
          .then(function (response) {
            if (first) {
              response.tileLayer.addTo(map)
              console.log(response.results)
              first = false
            } else {
              response.tileLayer.redraw()
            }
          })
          .catch(function (err) {
            window.alert(err)
          })
      })
  </script>
</body>
</html>